#Author: ichivite@esri.com

import os, arcpy, queue

def main(argv=None):

    path = r"\\boson\TestFiles\SD"                                      #Path to folder containing Service Definitions
    serverConnection = r"D:\tests\ismael.ags"                           #ArcGIS Server connection file

    print "This script publishes all Service Definitions at {0} into {1}".format(path, serverConnection)

    #Build a Queue containing all service definition files within the input folder and its subdirectories
    queue = Queue.Queue()
    for root, subFolders, files in os.walk(path):
        for fname in files:
            extension = os.path.splitext(filename)[1][1:].strip().lower()
            if extension == 'sd':
                 
                print " Publishing " + fname
                serviceDefinitionFile = os.path.join(path,fname)
                queue.put(serviceDefinitionFile)
                try:
                    arcpy.UploadServiceDefinition_server(serviceDefinitionFile, serverConnection)
                except Exception, err:
                    print "    ... publishing failed. {0}".format(fname)
                    
    #Create a pool of threads
    
    #Start threads
    
    #Wait for threads to finish

if __name__ == "__main__":
     sys.exit(main(sys.argv[1:]))
